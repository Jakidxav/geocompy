<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
  <meta charset="utf-8">
  <meta name="generator" content="quarto-0.9.56">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="description" content="Work in Progress 🎉">
  <title>Geocomputation with Python - 2&nbsp; Geographic data in Python</title>
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    span.underline{text-decoration: underline;}
    div.column{display: inline-block; vertical-align: top; width: 50%;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>

  <script src="site_libs/quarto-nav/quarto-nav.js"></script>
  <script src="site_libs/quarto-nav/headroom.min.js"></script>
  <script src="site_libs/clipboard/clipboard.min.js"></script>
  <meta name="quarto:offset" content="./">
  <script src="site_libs/quarto-search/autocomplete.umd.js"></script>
  <script src="site_libs/quarto-search/fuse.min.js"></script>
  <script src="site_libs/quarto-search/quarto-search.js"></script>
  <link href="./03-attribute-operations.html" rel="next">
  <link href="./index.html" rel="prev">
  <script src="site_libs/quarto-html/quarto.js"></script>
  <script src="site_libs/quarto-html/popper.min.js"></script>
  <script src="site_libs/quarto-html/tippy.umd.min.js"></script>
  <script src="site_libs/quarto-html/anchor.min.js"></script>
  <link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
  <link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet">
  <script src="site_libs/bootstrap/bootstrap.min.js"></script>
  <link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
  <link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet">
  <script id="quarto-search-options" type="application/json">{
    "location": "sidebar",
    "copy-button": false,
    "collapse-after": 2,
    "panel-placement": "start",
    "type": "textbox",
    "limit": 20,
    "language": {
      "search-no-results-text": "No results",
      "search-matching-documents-text": "matching documents",
      "search-copy-link-title": "Copy link to search",
      "search-hide-matches-text": "Hide additional matches",
      "search-more-match-text": "more match in this document",
      "search-more-matches-text": "more matches in this document",
      "search-clear-button-title": "Clear",
      "search-detached-cancel-button-title": "Cancel",
      "search-submit-button-title": "Submit"
    }
  }</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
  <script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body class="floating">
<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Geographic data in Python</span></h1>
      <button type="button" class="quarto-btn-toggle btn">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Geocomputation with Python</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/geocompr/py/" title="Source Code" class="sidebar-tool px-1"><i class="bi bi-github"></i></a>
    <a href="" title="Share" id="sidebar-tool-dropdown-0" class="sidebar-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi bi-share"></i></a>
    <ul class="dropdown-menu" aria-labelledby="sidebar-tool-dropdown-0">
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=|url|">
            <i class="bi bi-bi-twitter pe-1"></i>
          Twitter
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=|url|">
            <i class="bi bi-bi-facebook pe-1"></i>
          Facebook
          </a>
        </li>
        <li>
          <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=|url|">
            <i class="bi bi-bi-linkedin pe-1"></i>
          LinkedIn
          </a>
        </li>
    </ul>
</div>
    </div>
      </div>
      <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
      </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02-spatial-data.html" class="sidebar-item-text sidebar-link active"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Geographic data in Python</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03-attribute-operations.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Attribute data operations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04-spatial-operations.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Spatial data operations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05-geometry-operations.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Geometry operations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06-raster-vector.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Raster-vector interactions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07-reproj.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reprojecting geographic data</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08-read-write-plot.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Geographic data I/O</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./09-mapping.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Making maps with Python</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
    <div class="sidebar-item-container"> 
        <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-appendices" aria-expanded="true">Appendices</a>
      <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-appendices" aria-expanded="true">
        <i class="bi bi-chevron-right ms-2"></i>
      </a>
    </div>
    <ul id="quarto-sidebar-section-appendices" class="collapse list-unstyled sidebar-section depth1 show">  
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a1-starting.html" class="sidebar-item-text sidebar-link"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">Installing R and RStudio</span></a>
  </div>
</li>
    </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc">
<h2 id="toc-title">Table of contents</h2>
<ul>
<li><a href="#introduction" class="nav-link active" data-scroll-target="#introduction"> <span class="header-section-number">2.1</span> Introduction</a></li>
<li><a href="#vector-data" class="nav-link" data-scroll-target="#vector-data"> <span class="header-section-number">2.2</span> Vector data</a>
<ul class="collapse">
<li><a href="#introduction-1" class="nav-link" data-scroll-target="#introduction-1"> <span class="header-section-number">2.2.1</span> Introduction</a></li>
<li><a href="#vector-layers" class="nav-link" data-scroll-target="#vector-layers"> <span class="header-section-number">2.2.2</span> Vector layers</a></li>
<li><a href="#geometry-columns" class="nav-link" data-scroll-target="#geometry-columns"> <span class="header-section-number">2.2.3</span> Geometry columns</a></li>
<li><a href="#geometries" class="nav-link" data-scroll-target="#geometries"> <span class="header-section-number">2.2.4</span> Geometries</a></li>
</ul></li>
<li><a href="#raster-data" class="nav-link" data-scroll-target="#raster-data"> <span class="header-section-number">2.3</span> Raster data</a>
<ul class="collapse">
<li><a href="#introduction-2" class="nav-link" data-scroll-target="#introduction-2"> <span class="header-section-number">2.3.1</span> Introduction</a></li>
<li><a href="#using-rasterio" class="nav-link" data-scroll-target="#using-rasterio"> <span class="header-section-number">2.3.2</span> Using <strong>rasterio</strong></a></li>
<li><a href="#using-xarray" class="nav-link" data-scroll-target="#using-xarray"> <span class="header-section-number">2.3.3</span> Using <code>xarray</code></a></li>
</ul></li>
<li><a href="#coordinate-reference-systems" class="nav-link" data-scroll-target="#coordinate-reference-systems"> <span class="header-section-number">2.4</span> Coordinate Reference Systems</a></li>
<li><a href="#exercises" class="nav-link" data-scroll-target="#exercises"> <span class="header-section-number">2.5</span> Exercises</a></li>
</ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/geocompr/py/edit/main/02-spatial-data.qmd" class="toc-action">Edit this page</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<header id="title-block-header">
<h1 class="title display-7"><span id="spatial-class" class="quarto-section-identifier d-none d-lg-block"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Geographic data in Python</span></span></h1>
</header>

<section id="introduction" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">2.1</span> Introduction</h2>
<p>In this chapter, we introduce the key Python packages (and data structures) for working with the two major types of spatial data, namely:</p>
<ul>
<li><strong>shapely</strong> and <strong>geopandas</strong> — for working with vector layers</li>
<li><strong>rasterio</strong> and <strong>xarray</strong> — for working with rasters</li>
</ul>
<p>As we will see later on, <strong>shapely</strong> and <strong>geopandas</strong> are related:</p>
<ul>
<li><strong>shapely</strong> is a “low-level” package for working with individual vector geometry objects</li>
<li><strong>geopandas</strong> is a “high-level” package for working with geometry columns (<code>GeoSeries</code> objects), which internally contain <strong>shapely</strong> geometries, and vector layers (<code>GeoDataFrame</code> objects)</li>
</ul>
<p>While <strong>geopandas</strong> (including its <strong>shapely</strong> dependency), at present, comprises a ubiquitous comprehensive approach for working with vector layers in Python, this is not the case for rasters. Work with rasters in Python is much less unified. There are several alternative packages, each with its own advantages and disadvantages. We focus on the two most comprehensive and fundamental packages, namely:</p>
<ul>
<li><strong>rasterio</strong> — a spatial-oriented package, focused on “simple” raster formats (such as GeoTIFF), representing a raster using a combination of a <code>numpy</code> array, and a metadata object (<code>dict</code>) specifying the spatial referencing of the array</li>
<li><strong>xarray</strong> — A general-purpose package for working with labeled arrays, thus advantageous for processing “complex” raster format (such as NetCDF), representing a raster using its own native classes, namely <code>xarray.Dataset</code> and <code>xarray.DataArray</code></li>
</ul>
</section>
<section id="vector-data" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="vector-data"><span class="header-section-number">2.2</span> Vector data</h2>
<section id="introduction-1" class="level3" data-number="2.2.1">
<h3 data-number="2.2.1" class="anchored" data-anchor-id="introduction-1"><span class="header-section-number">2.2.1</span> Introduction</h3>
<p>When introducing the packages for working with vector layers in Python, we are going to go from the complex class (vector layer), through the intermediate (geometry column), to the simple (geometry). As we will see, the three classes are hierarchical, meaning that the complex encompasses the simple:</p>
<ul>
<li>A vector layer (class <code>GeoDataFrame</code>) contains a geometry column (class <code>GeoSeries</code>) as one of the columns</li>
<li>A geometry column (class <code>GeoSeries</code>) is composed of individual geometries (class <code>shapely</code>)</li>
</ul>
<p>The first two classes (<code>GeoDataFrame</code> and <code>GeoSeries</code>) are defined in package <strong>geopandas</strong>. The third class is defined in package <strong>shapely</strong>, which deals with individual geometries, and comprises on of the dependencies of the <strong>geopandas</strong> package.</p>
</section>
<section id="vector-layers" class="level3" data-number="2.2.2">
<h3 data-number="2.2.2" class="anchored" data-anchor-id="vector-layers"><span class="header-section-number">2.2.2</span> Vector layers</h3>
<p>The typical data structure for vector data is a vector layer. There are several methods to work with vector layers in Python, ranging from low-level (e.g., <strong>fiona</strong>) to high-level (<strong>geopandas</strong>). In this book, we focus on <strong>geopandas</strong>.</p>
<p>Before we begin, we need to import the <strong>geopandas</strong> package, conventionally as <code>gpd</code>:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode" id="cb1"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> geopandas <span class="im">as</span> gpd</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will also limit the maximum number of printed rows to four, to save space, using the <code>"display.max_rows"</code> option of <strong>pandas</strong>:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode" id="cb2"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>pd.set_option(<span class="st">"display.max_rows"</span>, <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Most often, we import an existing vector layer from a file, such as a Shapefile or a GeoPackage file.</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode" id="cb3"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> gpd.read_file(<span class="st">"data/world.gpkg"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The result is a <code>GeoDataFrame</code>:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode" id="cb4"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="bu">type</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="4">
<pre><code>geopandas.geodataframe.GeoDataFrame</code></pre>
</div>
</div>
<p>The <code>GeoDataFrame</code> class is an extension of the <code>DataFrame</code> class. Thus, we can treat a vector layer as a table and process it using the ordinary, i.e., non-spatial, <strong>pandas</strong> methods. For example, the following expression creates a subset with just the country name and the geometry (see below):</p>
<div class="cell" data-execution_count="5">
<div class="sourceCode" id="cb6"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>dat <span class="op">=</span> dat[[<span class="st">"name_long"</span>, <span class="st">"geometry"</span>]]</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="5">
<div>

<table class="dataframe table">
  <thead>
    <tr>
      <th></th>
      <th>name_long</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Fiji</td>
      <td>MULTIPOLYGON (((-180.00000 -16.55522, -179.917...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Tanzania</td>
      <td>MULTIPOLYGON (((33.90371 -0.95000, 31.86617 -1...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>175</th>
      <td>Trinidad and Tobago</td>
      <td>MULTIPOLYGON (((-61.68000 10.76000, -61.66000 ...</td>
    </tr>
    <tr>
      <th>176</th>
      <td>South Sudan</td>
      <td>MULTIPOLYGON (((30.83385 3.50917, 31.24556 3.7...</td>
    </tr>
  </tbody>
</table>
<p>177 rows × 2 columns</p>
</div>
</div>
</div>
<p>The following expression creates a subset based on a condition, including just <code>"Egypt"</code>:</p>
<div class="cell" data-execution_count="6">
<div class="sourceCode" id="cb7"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dat[dat[<span class="st">"name_long"</span>] <span class="op">==</span> <span class="st">"Egypt"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="6">
<div>

<table class="dataframe table">
  <thead>
    <tr>
      <th></th>
      <th>name_long</th>
      <th>geometry</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>163</th>
      <td>Egypt</td>
      <td>MULTIPOLYGON (((36.86623 22.00000, 36.69069 22...</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Finally, to get a sense of the spatial component of the vector layer, it can be plotted using the <code>.plot</code> method, as follows:</p>
<div class="cell" data-execution_count="7">
<div class="sourceCode" id="cb8"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dat.plot()<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-spatial-data_files/figure-html/cell-8-output-1.png" width="577" height="293"></p>
</div>
</div>
<div class="cell" data-execution_count="8">
<div class="sourceCode" id="cb9"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Todo: eval when fixed</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>lot.pandas</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>dat.hvplot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="geometry-columns" class="level3" data-number="2.2.3">
<h3 data-number="2.2.3" class="anchored" data-anchor-id="geometry-columns"><span class="header-section-number">2.2.3</span> Geometry columns</h3>
<p>One of the columns in a <code>GeoDataFrame</code> is a geometry column, of class <code>GeoSeries</code>. The geometry column contains the geometric part of the vector layer, e.g., the <code>POLYGON</code> or <code>MULTIPOLYGON</code> geometries of the 177 countries in <code>dat</code>:</p>
<div class="cell" data-execution_count="9">
<div class="sourceCode" id="cb10"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="st">"geometry"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="8">
<pre><code>0      MULTIPOLYGON (((-180.00000 -16.55522, -179.917...
1      MULTIPOLYGON (((33.90371 -0.95000, 31.86617 -1...
                             ...                        
175    MULTIPOLYGON (((-61.68000 10.76000, -61.66000 ...
176    MULTIPOLYGON (((30.83385 3.50917, 31.24556 3.7...
Name: geometry, Length: 177, dtype: geometry</code></pre>
</div>
</div>
<p>The geometry column also contains the spatial reference information, if any (see below).</p>
<p>Many of the spatial operators, such as calculating the centroid, buffer, or bounding box of each feature, in fact involve just the geometry. Therefore, for example, the following expressions give exactly the same result, a <code>GeoSeries</code> with country bounding boxes:</p>
<div class="cell" data-execution_count="10">
<div class="sourceCode" id="cb12"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>dat.bounds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="9">
<div>

<table class="dataframe table">
  <thead>
    <tr>
      <th></th>
      <th>minx</th>
      <th>miny</th>
      <th>maxx</th>
      <th>maxy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-180.000000</td>
      <td>-18.287990</td>
      <td>179.999990</td>
      <td>-16.020882</td>
    </tr>
    <tr>
      <th>1</th>
      <td>29.339998</td>
      <td>-11.720938</td>
      <td>40.316590</td>
      <td>-0.950000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>175</th>
      <td>-61.950000</td>
      <td>10.000000</td>
      <td>-60.895000</td>
      <td>10.890000</td>
    </tr>
    <tr>
      <th>176</th>
      <td>23.886980</td>
      <td>3.509172</td>
      <td>35.298007</td>
      <td>12.248008</td>
    </tr>
  </tbody>
</table>
<p>177 rows × 4 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode" id="cb13"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="st">"geometry"</span>].bounds</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="10">
<div>

<table class="dataframe table">
  <thead>
    <tr>
      <th></th>
      <th>minx</th>
      <th>miny</th>
      <th>maxx</th>
      <th>maxy</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-180.000000</td>
      <td>-18.287990</td>
      <td>179.999990</td>
      <td>-16.020882</td>
    </tr>
    <tr>
      <th>1</th>
      <td>29.339998</td>
      <td>-11.720938</td>
      <td>40.316590</td>
      <td>-0.950000</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>175</th>
      <td>-61.950000</td>
      <td>10.000000</td>
      <td>-60.895000</td>
      <td>10.890000</td>
    </tr>
    <tr>
      <th>176</th>
      <td>23.886980</td>
      <td>3.509172</td>
      <td>35.298007</td>
      <td>12.248008</td>
    </tr>
  </tbody>
</table>
<p>177 rows × 4 columns</p>
</div>
</div>
</div>
<p>Another useful property of the geometry column is the geometry type (see below). Note that the types of geometries contained in a geometry column (and, thus, a vector layer) are not necessarily the same. Accordingly, the <code>.type</code> property returns a <code>Series</code> (of type <code>string</code>), rather than a single value:</p>
<div class="cell" data-execution_count="12">
<div class="sourceCode" id="cb14"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="st">"geometry"</span>].<span class="bu">type</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="11">
<pre><code>0      MultiPolygon
1      MultiPolygon
           ...     
175    MultiPolygon
176    MultiPolygon
Length: 177, dtype: object</code></pre>
</div>
</div>
<p>To summarize the occurrence of different geometry types in a geometry column, we can use the <strong>pandas</strong> method called <code>value_counts</code>:</p>
<div class="cell" data-execution_count="13">
<div class="sourceCode" id="cb16"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="st">"geometry"</span>].<span class="bu">type</span>.value_counts()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="12">
<pre><code>MultiPolygon    177
dtype: int64</code></pre>
</div>
</div>
<p>In this case, we see that the <code>dat</code> layer contains <code>Polygon</code> and <code>MultiPolygon</code> geometries.</p>
</section>
<section id="geometries" class="level3" data-number="2.2.4">
<h3 data-number="2.2.4" class="anchored" data-anchor-id="geometries"><span class="header-section-number">2.2.4</span> Geometries</h3>
<p>Each element in the geometry column is a geometry object, of class <code>shapely</code>. For example, here is one specific geometry selected by implicit index (that of Canada):</p>
<div class="cell" data-execution_count="14">
<div class="sourceCode" id="cb18"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="st">"geometry"</span>].iloc[<span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="13">
<p><img src="02-spatial-data_files/figure-html/cell-15-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>and here is a specific geometry selected based on the <code>"name_long"</code> attribute:</p>
<div class="cell" data-execution_count="15">
<div class="sourceCode" id="cb19"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dat[dat[<span class="st">"name_long"</span>] <span class="op">==</span> <span class="st">"Egypt"</span>][<span class="st">"geometry"</span>].iloc[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="14">
<p><img src="02-spatial-data_files/figure-html/cell-16-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>The <strong>shapely</strong> package is compatible with the Simple Features standard. Accordingly, seven types of geometries are supported. The following section demonstrates creating a <code>shapely</code> geometry of each type, using a <code>string</code> in the WKT format as input. First, we need to import the <code>shapely.wkt</code> module:</p>
<div class="cell" data-execution_count="16">
<div class="sourceCode" id="cb20"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> shapely.wkt <span class="im">as</span> wkt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we use the <code>wkt.loads</code> (stands for “load a WKT <em>s</em>tring”) to transform a WKT string to a <code>shapely</code> geometry object. Here is an example of a <code>POINT</code> geometry:</p>
<div class="cell" data-execution_count="17">
<div class="sourceCode" id="cb21"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>point <span class="op">=</span> wkt.loads(<span class="st">"POINT (5 2)"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>point</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="16">
<p><img src="02-spatial-data_files/figure-html/cell-18-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Here is an example of a <code>MULTIPOINT</code> geometry:</p>
<div class="cell" data-execution_count="18">
<div class="sourceCode" id="cb22"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>multipoint <span class="op">=</span> wkt.loads(<span class="st">"MULTIPOINT ((5 2), (1 3), (3 4), (3 2))"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>multipoint</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="17">
<p><img src="02-spatial-data_files/figure-html/cell-19-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Here is an example of a <code>LINESTRING</code> geometry:</p>
<div class="cell" data-execution_count="19">
<div class="sourceCode" id="cb23"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>linestring <span class="op">=</span> wkt.loads(<span class="st">"LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)"</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>linestring</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="18">
<p><img src="02-spatial-data_files/figure-html/cell-20-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Here is an example of a <code>MULTILINESTRING</code> geometry:</p>
<div class="cell" data-execution_count="20">
<div class="sourceCode" id="cb24"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>multilinestring <span class="op">=</span> wkt.loads(<span class="st">"MULTILINESTRING ((1 5, 4 4, 4 1, 2 2, 3 2), (1 2, 2 4))"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>multilinestring</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="19">
<p><img src="02-spatial-data_files/figure-html/cell-21-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Here is an example of a <code>POLYGON</code> geometry:</p>
<div class="cell" data-execution_count="21">
<div class="sourceCode" id="cb25"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>polygon <span class="op">=</span> wkt.loads(<span class="st">"POLYGON ((1 5, 2 2, 4 1, 4 4, 1 5), (2 4, 3 4, 3 3, 2 3, 2 4))"</span>)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>polygon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="20">
<p><img src="02-spatial-data_files/figure-html/cell-22-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Here is an example of a <code>MULTIPOLYGON</code> geometry:</p>
<div class="cell" data-execution_count="22">
<div class="sourceCode" id="cb26"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>multipolygon <span class="op">=</span> wkt.loads(<span class="st">"MULTIPOLYGON (((1 5, 2 2, 4 1, 4 4, 1 5)), ((0 2, 1 2, 1 3, 0 3, 0 2)))"</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>multipolygon</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="21">
<p><img src="02-spatial-data_files/figure-html/cell-23-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>And, finally, here is an example of a <code>GEOMETRYCOLLECTION</code> geometry:</p>
<div class="cell" data-execution_count="23">
<div class="sourceCode" id="cb27"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>geometrycollection <span class="op">=</span> wkt.loads(<span class="st">"GEOMETRYCOLLECTION (MULTIPOINT (5 2, 1 3, 3 4, 3 2), LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2))"</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>geometrycollection</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="22">
<p><img src="02-spatial-data_files/figure-html/cell-24-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p><code>shapely</code> geometries act as atomic units of vector data, as spatial operations on a geometry return a single new geometry. For example, the following expression calculates the difference between the buffered <code>multipolygon</code> (using distance of <code>0.1</code>) and itself:</p>
<div class="cell" data-execution_count="24">
<div class="sourceCode" id="cb28"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>multipolygon.<span class="bu">buffer</span>(<span class="fl">0.2</span>).difference(multipolygon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="23">
<p><img src="02-spatial-data_files/figure-html/cell-25-output-1.svg" class="img-fluid"></p>
</div>
</div>
<p>Internally, many spatial operations on a geometry column (or a vector layer) are basically iterations where the operator is applied on all geometries, one by one, to return a new geometry column (or layer) with the combined results.</p>
<p>As demonstrated above, a <code>shapely</code> geometry object is automatically evaluated to a small image of the geometry (when using an interface capable of displaying it, such as a Jupyter Notebook). To print the WKT string instead, we can use the <code>print</code> function:</p>
<div class="cell" data-execution_count="25">
<div class="sourceCode" id="cb29"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(linestring)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-stdout">
<pre><code>LINESTRING (1 5, 4 4, 4 1, 2 2, 3 2)</code></pre>
</div>
</div>
<p>We can determine the geometry type using the <code>.geom_type</code> property, which is a <code>string</code>:</p>
<div class="cell" data-execution_count="26">
<div class="sourceCode" id="cb31"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>linestring.geom_type</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="25">
<pre><code>'LineString'</code></pre>
</div>
</div>
<p>Finally, it is important to note that raw coordinates of <code>shapely</code> geometries are accessible through a combination of the <code>.coords</code>, <code>.geoms</code>, <code>.exterior</code>, and <code>.interiors</code>, properties (depending on the geometry type). These access methods are useful for when we need to develop our own spatial operators for specific tasks. For example, the following expression returns the coordinates of the <code>polygon</code> geometry exterior (note that the returned object is iterable, thus enclosed in a <code>list</code> to return all coordinates at once):</p>
<div class="cell" data-execution_count="27">
<div class="sourceCode" id="cb33"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="bu">list</span>(polygon.exterior.coords)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="26">
<pre><code>[(1.0, 5.0), (2.0, 2.0), (4.0, 1.0), (4.0, 4.0), (1.0, 5.0)]</code></pre>
</div>
</div>
</section>
</section>
<section id="raster-data" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="raster-data"><span class="header-section-number">2.3</span> Raster data</h2>
<section id="introduction-2" class="level3" data-number="2.3.1">
<h3 data-number="2.3.1" class="anchored" data-anchor-id="introduction-2"><span class="header-section-number">2.3.1</span> Introduction</h3>
<p>As mentioned above, working with rasters in Python is less organized around one comprehensive package (such as the case for vector layers and <strong>geopandas</strong>). Instead, there are several packages providing alternative (subsets of methods) of working with raster data.</p>
<p>The two most notable approaches for working with rasters in Python are provided by the <strong>rasterio</strong> and <strong>xarray</strong> packages. As we will see shortly, they differ in their scope and underlying data models. Specifically, <strong>rasterio</strong> represents rasters as <strong>numpy</strong> arrays associated with a separate object holding the spatial metadata. The <strong>xarray</strong> package, however, represents rasters with the native <code>DataArray</code> object, which is an extension of <strong>numpy</strong> array designed to hold axis labels and attributes, in the same object, together with the array of raster values.</p>
<p>Both packages are not comprehensive in the same way as <strong>geopandas</strong> is. For example, when working with <strong>rasterio</strong>, on the one hand, more packages may be needed to accomplish (commonly used) tasks such as zonal statistics (package <code>zonalstats</code>) or calculating topographic indices (package <code>richdem</code>). On the other hand, <strong>xarray</strong> was extended to accommodate spatial operators missing from the core package itself, with the <strong>rioxarray</strong> and <strong>xarray-spatial</strong> packages.</p>
<p>In the following two sections, we introduce the two well-established packages, <strong>rasterio</strong> and <strong>xarray</strong>, which form the basis for most raster functionality in Python. Using any of the add-on packages, or the extensions, should be straightforward, once the reader is familiar with the basics.</p>
</section>
<section id="using-rasterio" class="level3" data-number="2.3.2">
<h3 data-number="2.3.2" class="anchored" data-anchor-id="using-rasterio"><span class="header-section-number">2.3.2</span> Using <strong>rasterio</strong></h3>
<p>To work with the <strong>rasterio</strong> package, we first need to import it. We also import <strong>numpy</strong>, since (as we will see shortly), the underlying raster data are stored in <strong>numpy</strong> arrays. To effectively work with those we therefore expose all <strong>numpy</strong> functions. Finally, we import the <code>show</code> function from the <code>rasterio.plot</code> sub-module for quick visualization of rasters.</p>
<div class="cell" data-execution_count="28">
<div class="sourceCode" id="cb35"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> rasterio</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rasterio.plot <span class="im">import</span> show</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> subprocess</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rasters are typically imported from existing files. When working with <strong>rasterio</strong>, “importing” a raster is actually a two-step process:</p>
<ul>
<li>First, we open a raster file “connection”, using <code>rasterio.open</code></li>
<li>Second, we read raster values from the connection using the <code>.read</code> method</li>
</ul>
<p>This kind of separation is analogous to basic Python functions for reading from files, such as <code>open</code> and <code>.readline</code> to read from a text file. The rationale is that we do not always want to read all information from the file into memory, which is particularly important as rasters size can be larger than RAM size. Accordingly, the second step (<code>.read</code>) is selective. For example, we may want to read just one raster band rather than reading all band.</p>
<p>In the first step, to create a file connection, we pass a file path to the <code>rasterio.open</code> function. For this example, we use a single-band raster representing elevation in Zion National Park:</p>
<div class="cell" data-execution_count="29">
<div class="sourceCode" id="cb36"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>src <span class="op">=</span> rasterio.<span class="bu">open</span>(<span class="st">"data/srtm.tif"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To get a first impression of the raster values, we can plot it using the <code>show</code> function:</p>
<div class="cell" data-execution_count="30">
<div class="sourceCode" id="cb37"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>show(src)<span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="02-spatial-data_files/figure-html/cell-31-output-1.png" width="435" height="404"></p>
</div>
</div>
<p>The “connection” object contains the raster metadata, that is, all of the information other than the raster values. Let us examine it:</p>
<div class="cell" data-execution_count="31">
<div class="sourceCode" id="cb38"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>src.meta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="30">
<pre><code>{'driver': 'GTiff',
 'dtype': 'uint16',
 'nodata': 65535.0,
 'width': 465,
 'height': 457,
 'count': 1,
 'crs': CRS.from_epsg(4326),
 'transform': Affine(0.0008333333332777796, 0.0, -113.23958321278403,
        0.0, -0.0008333333332777843, 37.512916763165805)}</code></pre>
</div>
</div>
<p>Importantly, we can see:</p>
<ul>
<li>The raster data type (<code>dtype</code>)</li>
<li>Raster dimensions (<code>width</code>, <code>height</code>, and <code>count</code>, i.e., number of layers)</li>
<li>Raster Coordinate Reference System (<code>crs</code>)</li>
<li>The raster affine transformation matrix (<code>transform</code>)</li>
</ul>
<p>The last item (i.e., <code>transform</code>) deserves a few more words. To position a raster in geographical space, in addition to the CRS we must specify the raster <em>origin</em> (<span class="math inline">\(x_{min}\)</span>, <span class="math inline">\(y_{max}\)</span>) and resolution (<span class="math inline">\(delta_{x}\)</span>, <span class="math inline">\(delta_{y}\)</span>). In the transform matrix notation, these data items are stored as follows:</p>
<pre class="{text}"><code>Affine(delta_x, 0.0, x_min,
       0.0, delta_y, y_max)</code></pre>
<p>Note that, by convention, raster y-axis origin is set to the maximum value (<span class="math inline">\(y_{max}\)</span>) rather than the minimum, and, accordingly, the y-axis resolution (<span class="math inline">\(delta_{y}\)</span>) is negative.</p>
<p>The <code>.read</code> method of a raster file connection object is used to read the last but not least piece of information: the raster values. Importantly, we can read:</p>
<ul>
<li>A particular layer, passing a numeric index (as in <code>.read(1)</code>)</li>
<li>A subset of layers, passing a <code>list</code> of indices (as in <code>.read([1,2])</code>)</li>
<li>All layers (as in <code>.read()</code>)</li>
</ul>
<p>Note that the layer indices start from <code>1</code> contrary to the Python convention of the first index being <code>0</code>.</p>
<p>The resulting object is a <strong>numpy</strong> array, with either two or three dimensions:</p>
<ul>
<li><em>Three</em> dimensions, when reading all layers or more than one layer (e.g., <code>.read()</code> or <code>.read([1,2])</code>). In such case, the dimensions pattern is <code>(layers, rows, columns)</code></li>
<li><em>Two</em> dimensions, when reading one specific layer (e.g., <code>.read(1)</code>)</li>
</ul>
<p>For example, let us read the first (and only) layer from the <code>srtm.tif</code> raster, using the file connection object <code>src</code>:</p>
<div class="cell" data-execution_count="32">
<div class="sourceCode" id="cb41"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>s <span class="op">=</span> src.read(<span class="dv">1</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>s</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="31">
<pre><code>array([[1728, 1718, 1715, ..., 2654, 2674, 2685],
       [1737, 1727, 1717, ..., 2649, 2677, 2693],
       [1739, 1734, 1727, ..., 2644, 2672, 2695],
       ...,
       [1326, 1328, 1329, ..., 1777, 1778, 1775],
       [1320, 1323, 1326, ..., 1771, 1770, 1772],
       [1319, 1319, 1322, ..., 1768, 1770, 1772]], dtype=uint16)</code></pre>
</div>
</div>
</section>
<section id="using-xarray" class="level3" data-number="2.3.3">
<h3 data-number="2.3.3" class="anchored" data-anchor-id="using-xarray"><span class="header-section-number">2.3.3</span> Using <code>xarray</code></h3>
<p>…</p>
<div class="cell" data-execution_count="33">
<div class="sourceCode" id="cb43"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> xarray <span class="im">as</span> xr</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Reading:</p>
<div class="cell" data-execution_count="34">
<div class="sourceCode" id="cb44"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Todo: uncomment when fixed on ci</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>url <span class="op">=</span> <span class="st">"https://github.com/geocompr/py/releases/download/0.1/air.2x2.250.mon.anom.comb.nc"</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>subprocess.run([<span class="st">"wget"</span>, <span class="st">"-P"</span>, <span class="st">"data"</span>, <span class="st">"-nc"</span>, url])</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> xr.open_dataset(<span class="st">"data/air.2x2.250.mon.anom.comb.nc"</span>)</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>x</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="35">
<div class="sourceCode" id="cb45"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>x[<span class="st">"air"</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Plot:</p>
<div class="cell" data-execution_count="36">
<div class="sourceCode" id="cb46"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>x[<span class="st">"air"</span>].plot()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="coordinate-reference-systems" class="level2" data-number="2.4">
<h2 data-number="2.4" class="anchored" data-anchor-id="coordinate-reference-systems"><span class="header-section-number">2.4</span> Coordinate Reference Systems</h2>
<div class="cell" data-execution_count="37">
<div class="sourceCode" id="cb47"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>dat.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="33">
<pre><code>&lt;Geographic 2D CRS: EPSG:4326&gt;
Name: WGS 84
Axis Info [ellipsoidal]:
- Lat[north]: Geodetic latitude (degree)
- Lon[east]: Geodetic longitude (degree)
Area of Use:
- name: World.
- bounds: (-180.0, -90.0, 180.0, 90.0)
Datum: World Geodetic System 1984 ensemble
- Ellipsoid: WGS 84
- Prime Meridian: Greenwich</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<div class="sourceCode" id="cb49"><pre class="sourceCode python cell-code code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>src.crs</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display" data-execution_count="34">
<pre><code>CRS.from_epsg(4326)</code></pre>
</div>
</div>
</section>
<section id="exercises" class="level2" data-number="2.5">
<h2 data-number="2.5" class="anchored" data-anchor-id="exercises"><span class="header-section-number">2.5</span> Exercises</h2>
<p>…</p>


</section>
</main> <!-- /main -->
<script type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    setTimeout(function() {
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      let href = ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03-attribute-operations.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Attribute data operations</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->


</body></html>